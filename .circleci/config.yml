version: 2
jobs:
  build: 
    machine: true
    steps:
      - checkout
      - run:   
          command: |
            # Setting up docker here.
            cd fa480.club-dockerfile/
            docker build --rm=true -t fa480.club-base .
            cd ..
            cd production-site-dockerfile
            docker build --rm=true -t production-site .
            docker tag site:$CIRCLE_SHA1
            ls
      - run:   
          command: |
            # This uploads the ProductionSite.txt to s3.
            sudo pip install awscli        
            aws s3 cp /home/circleci/project/ProductionSite.txt s3://csuneat-project-2/
            sudo rm /home/circleci/project/ProductionSite.txt
      - run:   
          command: |
            # Adding Staging Site to s3.
            touch StagingSite.txt
            echo $CIRCLE_SHA1 > StagingSite.txt
            aws s3 cp StagingSite.txt s3://csuneat-project-2
      - run:
         command: |
           # Upload image to ECR here.
           aws ecr put-image --repository-name beats-repo --image-tag site:$CIFRCLE_SHA1 
            
            
            
